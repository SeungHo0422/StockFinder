<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스크리닝 결과 - StockFinder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line me-2"></i>StockFinder
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>홈
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/screening">
                            <i class="fas fa-search me-1"></i>스크리닝
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/results">
                            <i class="fas fa-list me-1"></i>결과
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings">
                            <i class="fas fa-cog me-1"></i>설정
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <div class="container">
            {% if results %}
            <!-- 결과 요약 -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-header">
                            <h3 class="mb-0">
                                <i class="fas fa-chart-bar me-2"></i>스크리닝 결과 요약
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <div class="text-center">
                                        <div class="stats-number text-primary">{{ results.total_stocks | default(0) | number }}</div>
                                        <div class="stats-label">전체 분석 종목</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="text-center">
                                        <div class="stats-number text-warning">{{ results.oversold_count | default(0) | number }}</div>
                                        <div class="stats-label">과매도 종목</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="text-center">
                                        <div class="stats-number text-info">{{ results.sar_buy_count | default(0) | number }}</div>
                                        <div class="stats-label">SAR 매수 신호</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="text-center">
                                        <div class="stats-number text-success">{{ results.golden_cross_count | default(0) | number }}</div>
                                        <div class="stats-label">최종 선택 종목</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <small class="text-secondary">
                                        <i class="fas fa-chart-line me-1"></i>
                                        조건: RSI < {{ results.rsi_threshold | default(30) }} ({{ results.condition_description | default('과매도') }})
                                    </small>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-secondary">
                                        <i class="fas fa-filter me-1"></i>
                                        대상: {{ results.target_market | default('ALL') }}
                                    </small>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-secondary">
                                    <i class="fas fa-clock me-1"></i>
                                    분석 시점: {{ results.analysis_time_str | default('N/A') }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 시장별 결과 -->
            {% if results.market_results %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-header">
                            <h4 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>시장별 결과 분포
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for market_code, market_data in results.market_results.items() %}
                                {% if market_data.golden_cross | length > 0 or market_data.sar_buy | length > 0 %}
                                <div class="col-lg-4 mb-3">
                                    <div class="card market-card {{ market_code.lower() }}">
                                        <div class="card-body">
                                            <h6 class="card-title fw-bold">
                                                {% if market_code == 'KOSPI' %}
                                                    <i class="fas fa-building me-2 text-success"></i>코스피
                                                {% elif market_code == 'KOSDAQ' %}
                                                    <i class="fas fa-rocket me-2 text-warning"></i>코스닥
                                                {% elif market_code == 'KONEX' %}
                                                    <i class="fas fa-lightbulb me-2 text-info"></i>코넥스
                                                {% else %}
                                                    <i class="fas fa-chart-line me-2"></i>{{ market_code }}
                                                {% endif %}
                                            </h6>
                                            <div class="row text-center">
                                                <div class="col-4">
                                                    <div class="stats-number small">{{ market_data.oversold | length }}</div>
                                                    <div class="stats-label small">과매도</div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="stats-number small">{{ market_data.sar_buy | length }}</div>
                                                    <div class="stats-label small">SAR매수</div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="stats-number small text-success">{{ market_data.golden_cross | length }}</div>
                                                    <div class="stats-label small">최종선택</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 1단계: RSI 과매도 종목 -->
            {% if results.oversold_stocks %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-header">
                            <h4 class="mb-0">
                                <i class="fas fa-chart-line me-2 text-info"></i>1단계: RSI 과매도 종목 ({{ results.oversold_stocks | length }}개)
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- 시장별 탭 -->
                            <ul class="nav nav-tabs mb-3" id="oversold-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="oversold-all-tab" data-bs-toggle="tab" data-bs-target="#oversold-all" type="button" role="tab">
                                        전체 ({{ results.oversold_stocks | length }})
                                    </button>
                                </li>
                                {% if results.market_results %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="oversold-kospi-tab" data-bs-toggle="tab" data-bs-target="#oversold-kospi" type="button" role="tab">
                                        코스피 ({{ results.market_results.KOSPI.oversold | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="oversold-kosdaq-tab" data-bs-toggle="tab" data-bs-target="#oversold-kosdaq" type="button" role="tab">
                                        코스닥 ({{ results.market_results.KOSDAQ.oversold | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="oversold-konex-tab" data-bs-toggle="tab" data-bs-target="#oversold-konex" type="button" role="tab">
                                        코넥스 ({{ results.market_results.KONEX.oversold | length }})
                                    </button>
                                </li>
                                {% endif %}
                            </ul>
                            
                            <!-- 탭 콘텐츠 -->
                            <div class="tab-content" id="oversold-tab-content">
                                <!-- 전체 종목 -->
                                <div class="tab-pane fade show active" id="oversold-all" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>시가</th>
                                                    <th>시장</th>
                                                </tr>
                                            </thead>
                                            <tbody id="oversold-all-tbody">
                                                {% for stock in results.oversold_stocks[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-info">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                    <td>
                                                        {% if stock.ticker in results.market_results.KOSPI.oversold %}
                                                            <span class="badge bg-success">코스피</span>
                                                        {% elif stock.ticker in results.market_results.KOSDAQ.oversold %}
                                                            <span class="badge bg-warning">코스닥</span>
                                                        {% elif stock.ticker in results.market_results.KONEX.oversold %}
                                                            <span class="badge bg-info">코넥스</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">기타</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.oversold_stocks | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-primary btn-sm" onclick="toggleMoreStocks('oversold-all', {{ results.oversold_stocks | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.oversold_stocks | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스피 종목 -->
                                {% if results.market_results %}
                                <div class="tab-pane fade" id="oversold-kospi" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="oversold-kospi-tbody">
                                                {% for stock in results.market_results.KOSPI.oversold[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-success">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSPI.oversold | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-success btn-sm" onclick="toggleMoreStocks('oversold-kospi', {{ results.market_results.KOSPI.oversold | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSPI.oversold | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스닥 종목 -->
                                <div class="tab-pane fade" id="oversold-kosdaq" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="oversold-kosdaq-tbody">
                                                {% for stock in results.market_results.KOSDAQ.oversold[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-warning">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSDAQ.oversold | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleMoreStocks('oversold-kosdaq', {{ results.market_results.KOSDAQ.oversold | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSDAQ.oversold | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코넥스 종목 -->
                                <div class="tab-pane fade" id="oversold-konex" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="oversold-konex-tbody">
                                                {% for stock in results.market_results.KONEX.oversold[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-info">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KONEX.oversold | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-info btn-sm" onclick="toggleMoreStocks('oversold-konex', {{ results.market_results.KONEX.oversold | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KONEX.oversold | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 2단계: SAR 매수 신호 종목 -->
            {% if results.sar_buy_signals %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-header">
                            <h4 class="mb-0">
                                <i class="fas fa-chart-line me-2 text-success"></i>2단계: SAR 매수 신호 종목 ({{ results.sar_buy_signals | length }}개)
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- 시장별 탭 -->
                            <ul class="nav nav-tabs mb-3" id="sar-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="sar-all-tab" data-bs-toggle="tab" data-bs-target="#sar-all" type="button" role="tab">
                                        전체 ({{ results.sar_buy_signals | length }})
                                    </button>
                                </li>
                                {% if results.market_results %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="sar-kospi-tab" data-bs-toggle="tab" data-bs-target="#sar-kospi" type="button" role="tab">
                                        코스피 ({{ results.market_results.KOSPI.sar_buy | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="sar-kosdaq-tab" data-bs-toggle="tab" data-bs-target="#sar-kosdaq" type="button" role="tab">
                                        코스닥 ({{ results.market_results.KOSDAQ.sar_buy | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="sar-konex-tab" data-bs-toggle="tab" data-bs-target="#sar-konex" type="button" role="tab">
                                        코넥스 ({{ results.market_results.KONEX.sar_buy | length }})
                                    </button>
                                </li>
                                {% endif %}
                            </ul>
                            
                            <!-- 탭 콘텐츠 -->
                            <div class="tab-content" id="sar-tab-content">
                                <!-- 전체 종목 -->
                                <div class="tab-pane fade show active" id="sar-all" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>시가</th>
                                                    <th>시장</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sar-all-tbody">
                                                {% for stock in results.sar_buy_signals[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-success">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                    <td>
                                                        {% if stock.ticker in results.market_results.KOSPI.sar_buy %}
                                                            <span class="badge bg-success">코스피</span>
                                                        {% elif stock.ticker in results.market_results.KOSDAQ.sar_buy %}
                                                            <span class="badge bg-warning">코스닥</span>
                                                        {% elif stock.ticker in results.market_results.KONEX.sar_buy %}
                                                            <span class="badge bg-info">코넥스</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">기타</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.sar_buy_signals | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-success btn-sm" onclick="toggleMoreStocks('sar-all', {{ results.sar_buy_signals | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.sar_buy_signals | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스피 종목 -->
                                {% if results.market_results %}
                                <div class="tab-pane fade" id="sar-kospi" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sar-kospi-tbody">
                                                {% for stock in results.market_results.KOSPI.sar_buy[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-success">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSPI.sar_buy | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-success btn-sm" onclick="toggleMoreStocks('sar-kospi', {{ results.market_results.KOSPI.sar_buy | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSPI.sar_buy | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스닥 종목 -->
                                <div class="tab-pane fade" id="sar-kosdaq" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sar-kosdaq-tbody">
                                                {% for stock in results.market_results.KOSDAQ.sar_buy[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-warning">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSDAQ.sar_buy | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleMoreStocks('sar-kosdaq', {{ results.market_results.KOSDAQ.sar_buy | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSDAQ.sar_buy | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코넥스 종목 -->
                                <div class="tab-pane fade" id="sar-konex" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sar-konex-tbody">
                                                {% for stock in results.market_results.KONEX.sar_buy[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-info">{{ loop.index }}</span></td>
                                                    <td><strong>{{ stock.name | default('N/A') }}</strong></td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KONEX.sar_buy | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-info btn-sm" onclick="toggleMoreStocks('sar-konex', {{ results.market_results.KONEX.sar_buy | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KONEX.sar_buy | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 3단계: MACD 골든크로스 종목 (최종 선택) -->
            {% if results.golden_cross_stocks %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-header">
                            <h4 class="mb-0">
                                <i class="fas fa-star me-2 text-warning"></i>3단계: MACD 골든크로스 종목 (최종 선택) ({{ results.golden_cross_stocks | length }}개)
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- 시장별 탭 -->
                            <ul class="nav nav-tabs mb-3" id="golden-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="golden-all-tab" data-bs-toggle="tab" data-bs-target="#golden-all" type="button" role="tab">
                                        전체 ({{ results.golden_cross_stocks | length }})
                                    </button>
                                </li>
                                {% if results.market_results %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="golden-kospi-tab" data-bs-toggle="tab" data-bs-target="#golden-kospi" type="button" role="tab">
                                        코스피 ({{ results.market_results.KOSPI.golden_cross | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="golden-kosdaq-tab" data-bs-toggle="tab" data-bs-target="#golden-kosdaq" type="button" role="tab">
                                        코스닥 ({{ results.market_results.KOSDAQ.golden_cross | length }})
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="golden-konex-tab" data-bs-toggle="tab" data-bs-target="#golden-konex" type="button" role="tab">
                                        코넥스 ({{ results.market_results.KONEX.golden_cross | length }})
                                    </button>
                                </li>
                                {% endif %}
                            </ul>
                            
                            <!-- 탭 콘텐츠 -->
                            <div class="tab-content" id="golden-tab-content">
                                <!-- 전체 종목 -->
                                <div class="tab-pane fade show active" id="golden-all" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>MACD</th>
                                                    <th>시가</th>
                                                    <th>시장</th>
                                                </tr>
                                            </thead>
                                            <tbody id="golden-all-tbody">
                                                {% for stock in results.golden_cross_stocks[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-warning">{{ loop.index }}</span></td>
                                                    <td>
                                                        <strong>{{ stock.name | default('N/A') }}</strong>
                                                        {% if stock.macd_golden_today %}
                                                        <span class="badge bg-warning ms-1">오늘 골든크로스</span>
                                                        {% endif %}
                                                    </td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><span class="badge bg-warning">{{ "%.2f" | format(stock.macd | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                    <td>
                                                        {% if stock.ticker in results.market_results.KOSPI.golden_cross %}
                                                            <span class="badge bg-success">코스피</span>
                                                        {% elif stock.ticker in results.market_results.KOSDAQ.golden_cross %}
                                                            <span class="badge bg-warning">코스닥</span>
                                                        {% elif stock.ticker in results.market_results.KONEX.golden_cross %}
                                                            <span class="badge bg-info">코넥스</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">기타</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.golden_cross_stocks | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleMoreStocks('golden-all', {{ results.golden_cross_stocks | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.golden_cross_stocks | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스피 종목 -->
                                {% if results.market_results %}
                                <div class="tab-pane fade" id="golden-kospi" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>MACD</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="golden-kospi-tbody">
                                                {% for stock in results.market_results.KOSPI.golden_cross[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-success">{{ loop.index }}</span></td>
                                                    <td>
                                                        <strong>{{ stock.name | default('N/A') }}</strong>
                                                        {% if stock.macd_golden_today %}
                                                        <span class="badge bg-warning ms-1">오늘 골든크로스</span>
                                                        {% endif %}
                                                    </td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><span class="badge bg-warning">{{ "%.2f" | format(stock.macd | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSPI.golden_cross | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-success btn-sm" onclick="toggleMoreStocks('golden-kospi', {{ results.market_results.KOSPI.golden_cross | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSPI.golden_cross | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코스닥 종목 -->
                                <div class="tab-pane fade" id="golden-kosdaq" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>MACD</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="golden-kosdaq-tbody">
                                                {% for stock in results.market_results.KOSDAQ.golden_cross[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-warning">{{ loop.index }}</span></td>
                                                    <td>
                                                        <strong>{{ stock.name | default('N/A') }}</strong>
                                                        {% if stock.macd_golden_today %}
                                                        <span class="badge bg-warning ms-1">오늘 골든크로스</span>
                                                        {% endif %}
                                                    </td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><span class="badge bg-warning">{{ "%.2f" | format(stock.macd | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KOSDAQ.golden_cross | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleMoreStocks('golden-kosdaq', {{ results.market_results.KOSDAQ.golden_cross | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KOSDAQ.golden_cross | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- 코넥스 종목 -->
                                <div class="tab-pane fade" id="golden-konex" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>순위</th>
                                                    <th>종목명</th>
                                                    <th>종목코드</th>
                                                    <th>RSI</th>
                                                    <th>SAR 신호</th>
                                                    <th>MACD</th>
                                                    <th>시가</th>
                                                </tr>
                                            </thead>
                                            <tbody id="golden-konex-tbody">
                                                {% for stock in results.market_results.KONEX.golden_cross[:10] %}
                                                <tr>
                                                    <td><span class="badge bg-info">{{ loop.index }}</span></td>
                                                    <td>
                                                        <strong>{{ stock.name | default('N/A') }}</strong>
                                                        {% if stock.macd_golden_today %}
                                                        <span class="badge bg-warning ms-1">오늘 골든크로스</span>
                                                        {% endif %}
                                                    </td>
                                                    <td><code>{{ stock.ticker | default('N/A') }}</code></td>
                                                    <td><span class="badge bg-info">{{ "%.2f" | format(stock.rsi | default(0)) }}</span></td>
                                                    <td><span class="badge bg-success">{{ stock.sar_strength | default('N/A') }}</span></td>
                                                    <td><span class="badge bg-warning">{{ "%.2f" | format(stock.macd | default(0)) }}</span></td>
                                                    <td><strong>{{ "{:,}".format(stock.current_open | default(0)) }}원</strong></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if results.market_results.KONEX.golden_cross | length > 10 %}
                                    <div class="text-center mt-3">
                                        <button class="btn btn-outline-info btn-sm" onclick="toggleMoreStocks('golden-konex', {{ results.market_results.KONEX.golden_cross | length }})">
                                            <i class="fas fa-chevron-down me-1"></i>더보기 ({{ results.market_results.KONEX.golden_cross | length - 10 }}개)
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% else %}
            <!-- 결과 없음 -->
            <div class="row">
                <div class="col-12">
                    <div class="card fade-in">
                        <div class="card-body text-center py-5">
                            <i class="fas fa-inbox fa-4x text-secondary mb-4"></i>
                            <h4 class="text-secondary mb-3">스크리닝 결과가 없습니다</h4>
                            <p class="text-secondary mb-4">
                                아직 스크리닝을 실행하지 않았거나, 조건을 만족하는 종목이 없습니다.
                            </p>
                            <a href="/screening" class="btn btn-primary btn-lg">
                                <i class="fas fa-play me-2"></i>새로운 스크리닝 시작
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 액션 버튼 -->
            <div class="row">
                <div class="col-12 text-center">
                    <div class="d-flex justify-content-center gap-3">
                        <a href="/screening" class="btn btn-primary">
                            <i class="fas fa-search me-2"></i>새로운 스크리닝
                        </a>
                        <a href="/" class="btn btn-primary">
                            <i class="fas fa-home me-2"></i>홈으로
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', path='/js/results.js') }}"></script>
</body>
</html> 